# 🎯 极简输入版动态计分引擎

## 核心设计哲学：**输入极简，计算智能**

用户只需提供三个信息：**等级、时长、心情**，系统就能通过智能推测和历史数据，自动计算出丰富的分数体验。

---

## 一、输入简化与智能推测矩阵

### 用户输入（仅3项）：
1. **等级和行为**：S/A/B/C/D（必需）
2. **时长**：分钟（必需）
3. **心情**：1-5星（可选，默认3星）

### 系统自动推测的6个维度：

| 推测维度 | 推测逻辑 | 数据来源 |
|---------|---------|---------|
| **精力水平** | 基于时间衰减+历史恢复模式 | 上次记录时间、睡眠数据（若授权）、行为间隔 |
| **专注度** | 基于行为类型+时段+历史表现 | 行为等级、当前时间、同类行为历史专注度 |
| **环境质量** | 基于时间段+地理位置（若授权） | 时间戳、位置数据（办公室/家/咖啡厅） |
| **连击状态** | 自动检测行为序列 | 最近3个行为记录 |
| **幸运加成** | 随机算法+平衡机制 | 系统随机数+用户历史幸运记录 |
| **时段加成** | 基于生物钟模型 | 时间戳+用户历史高效时段分析 |

---

## 二、极简但精妙的计分公式

### 核心公式V4.0（仅需3输入）
```
单次得分 = 基础分 × 时长 × 动态系数 × 心情系数
```

### 1. 基础分表（精心校准的每分钟分值）

| 等级 | 基础分/分钟 | 精力消耗/分钟 | 心理锚点 | 适用行为举例 |
|------|-----------|-------------|---------|------------|
| **S** | 1.8分 | 0.35点 | "突破性成长" | 深度工作、攻克难题、高强度训练 |
| **A** | 1.2分 | 0.25点 | "有效进步" | 学习新知识、创造性工作、专注阅读 |
| **B** | 0.7分 | 0.18点 | "稳定维持" | 复习、整理、轻度运动、家务 |
| **C** | -0.5分 | 0.10点 | "时间流逝" | 无目的刷手机、看无聊视频 |
| **D** | -1.0分 | 0.15点 | "自我损害" | 熬夜、暴食、过度放纵 |

**设计原理**：
- S级：付出最多，但长期回报最高（复利效应）
- A级：日常成长的骨干力量
- B级：防止"全或无"思维，奖励微习惯
- C/D级：扣分设计为非对称性，D级惩罚更重

### 2. 动态系数（智能推测的核心）

```
动态系数 = 精力系数 × 时段系数 × 连击系数 × 幸运系数
```

#### 2.1 精力系数（自动推算模型）
```
当前精力 = 上次精力 - 间隔消耗 + 自动恢复

精力系数公式：
if 当前精力 > 70: 系数 = 1.0 + (当前精力-70)×0.01
else if 当前精力 > 40: 系数 = 0.85 + (当前精力-40)×0.005
else: 系数 = 0.7  （低能量保护）
```

**自动恢复规则**：
- 间隔>30分钟：每分钟恢复0.02点
- 间隔包含睡眠：每小时睡眠恢复5-10点（基于质量推测）
- B级行为后：自动恢复行为消耗的20%

#### 2.2 时段系数（基于时间戳自动判断）

| 时段类型 | 时间范围 | 系数 | 逻辑 |
|---------|---------|------|------|
| **黄金时段** | 用户历史高效时段或9-11, 15-17 | 1.3 | 认知高峰期 |
| **白银时段** | 8-9, 14-15, 19-21 | 1.1 | 次佳工作期 |
| **标准时段** | 其他清醒时间 | 1.0 | 正常效率 |
| **疲劳时段** | 13-14, 22-24 | 0.8 | 生理低谷 |
| **休息时段** | 0-6点 | 0.5 | 应睡眠时间 |

**智能优化**：系统会记录用户在哪些时段效率最高，逐渐个性化调整。

#### 2.3 连击系数（自动序列检测）

系统自动检查最近2个行为：
- **正向连击**：连续S/A/B级
  - 2连击：×1.1
  - 3连击：×1.2
  - 4+连击：×1.3（上限）
  
- **领域专精**：连续同领域（学习/健康/工作）
  - 额外×1.15

- **负向中断**：C/D级行为会重置连击，但：
  - 中断后第一个正面行为享受"反弹奖励"×1.1

#### 2.4 幸运系数（惊喜引擎）
```
每日基础幸运率 = 15%
衰减因子 = 0.95^(当日已记录行为数)
实际幸运率 = 基础幸运率 × 衰减因子
```

触发幸运时：
- 普通幸运：×1.5
- 超级幸运（5%概率）：×2.0
- 安慰幸运（连续3次未触发）：下次必触发

### 3. 心情系数（用户唯一可选输入）

| 心情星级 | 系数 | 对得分影响 | 心理作用 |
|---------|------|-----------|---------|
| ★☆☆☆☆ | 0.7 | 显著降低 | "承认今天的艰难" |
| ★★☆☆☆ | 0.85 | 适度降低 | "不太理想但可接受" |
| ★★★☆☆ | 1.0 | 无影响 | "标准状态" |
| ★★★★☆ | 1.2 | 适度提升 | "状态不错" |
| ★★★★★ | 1.4 | 显著提升 | "巅峰体验" |

**设计巧思**：
- 低心情不惩罚，只是少奖励
- 高心情有超额回报，强化积极体验
- 默认3星，避免决策疲劳

---

## 三、上瘾循环的极简实现

### 1. "开始即奖励"机制
每个行为的前5分钟，享受：
- 积分×1.2（启动加成）
- 精力消耗×0.8（启动保护）

### 2. "渐进惊喜"系统
```
当单次行为得分达到：
- 50分：解锁小成就动画
- 100分：触发"高效时刻"特效
- 200分：触发"大师时刻"全屏庆祝
```

### 3. "完美收官"奖励
当日最后一个正面行为：
- 积分×1.3（完美收官加成）
- 次日初始精力+5（睡得好奖励）

### 4. "成长可见性"设计
系统自动计算并显示：
- **今日总积分**（最显眼）
- **能量效率比** = 总积分 / 总消耗
- **连击成就**（徽章系统）
- **历史对比**（比昨天/上周同期）

---

## 四、实例：程序员小明的一天（极简输入版）

### 小明输入记录：
1. 上午9:00-10:30 | S级 | 90分钟 | ★★★★☆
2. 下午14:00-15:00 | A级 | 60分钟 | ★★★☆☆
3. 晚上20:00-20:30 | C级 | 30分钟 | ★★☆☆☆

### 系统自动推测与计算：

#### 记录1：深度编程（S级）
- **基础分**：1.8×90 = 162
- **动态系数**：
  - 精力系数：早晨初始精力100 → 1.3
  - 时段系数：黄金时段 → 1.3
  - 连击系数：第一个行为 → 1.0
  - 幸运系数：触发幸运 → 1.5
- **心情系数**：★★★★☆ → 1.2
- **最终得分**：162×1.3×1.3×1.0×1.5×1.2 = **493分！**
- **精力消耗**：90×0.35 = 31.5点
- **精力剩余**：100 - 31.5 = 68.5点

#### 记录2：学习新技术（A级）
- **基础分**：1.2×60 = 72
- **动态系数**：
  - 精力系数：68.5 → 0.985
  - 时段系数：白银时段 → 1.1
  - 连击系数：正向连击（第2个）→ 1.1
  - 幸运系数：未触发 → 1.0
- **心情系数**：★★★☆☆ → 1.0
- **最终得分**：72×0.985×1.1×1.1×1.0×1.0 = **85.7分**
- **精力消耗**：60×0.25 = 15点
- **精力剩余**：68.5 - 15 = 53.5点
- **自动恢复**：间隔中有午餐休息，恢复12点 → 实际65.5点

#### 记录3：刷社交媒体（C级）
- **基础分**：-0.5×30 = -15
- **动态系数**：
  - 精力系数：65.5 → 0.955
  - 时段系数：标准时段 → 1.0
  - 连击系数：中断连击 → 1.0
  - 幸运系数：安慰幸运（连续2次未触发）→ 1.5
- **心情系数**：★★☆☆☆ → 0.85
- **最终扣分**：-15×0.955×1.0×1.0×1.5×0.85 = **-18.2分**
- **精力消耗**：30×0.10 = 3点
- **精力剩余**：65.5 - 3 = 62.5点

### 日终统计：
- **总积分**：493 + 85.7 - 18.2 = **560.5分**
- **总消耗**：49.5点
- **能量效率**：11.3分/点（优秀）
- **连击成就**：2连击
- **幸运时刻**：2次触发

**小明感受**："我只选了等级、时长和心情，系统就给了我这么丰富的反馈！看到快500分的时候真的想继续！"

---

## 五、防滥用与平衡机制

### 1. 防刷分保护
- 同一行为重复：第4次起收益递减20%
- 短时长高频：10分钟内重复记录，第二次起系数×0.7
- 负分行为保护：单日C/D级扣分不超过总分的30%

### 2. 新手友好设计
- 首周：所有系数×1.2（鼓励期）
- 首次使用S级：额外+50分"勇气奖励"
- 前3次记录错误：允许撤回重记

### 3. 疲劳保护
- 连续工作>2小时：自动弹出休息建议
- 精力<30时：正面行为系数上限0.9
- 深夜记录（0-6点）：所有行为系数×0.7

---
